<!doctype html>
<html lang="ar">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>ÙƒØ§Ø³Ø­Ø© Ø§Ù„Ø£Ù„ØºØ§Ù… - Ø§Ù„Ù†Ø³Ø®Ø© Ø§Ù„Ù…Ø·ÙˆØ±Ø©</title>
  <style>
    :root{
      --cell-size-desktop: 36px;
      --cell-size-mobile: 44px;
      --gap: 4px;

      --bg: #0f1724;
      --panel: linear-gradient(180deg,#0b1220,#0f2436);
      --card: rgba(255,255,255,0.03);
      --accent-1: #7dd3fc;
      --accent-2: #60a5fa;
      --accent-3: #a78bfa;
      --flag: #fb7185;
      --mine: #ef4444;
      --text: #e6eef6;
    }
    *{box-sizing:border-box;font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif}
    html,body{height:100%;margin:0;background:var(--bg);color:var(--text);}
    .wrap{min-height:100%;display:flex;flex-direction:column;align-items:center;padding:28px 16px}
    header{width:100%;max-width:980px;margin-bottom:18px;display:flex;align-items:center;justify-content:space-between}
    .brand{display:flex;gap:12px;align-items:center}
    .logo{width:48px;height:48px;border-radius:10px;background:linear-gradient(135deg,var(--accent-1),var(--accent-3));display:flex;align-items:center;justify-content:center;font-weight:700}
    h1{font-size:18px;margin:0}
    .controls{display:flex;gap:8px;align-items:center}
    .panel{width:100%;max-width:980px;background:var(--panel);padding:14px;border-radius:14px;box-shadow:0 6px 20px rgba(2,6,23,0.6)}
    .meta{display:flex;gap:12px;align-items:center;flex-wrap:wrap;margin-bottom:12px}
    .meta .info{background:var(--card);padding:6px 10px;border-radius:8px;font-size:13px}
    .game-area{display:flex;gap:16px}
    .board-wrap{background:rgba(255,255,255,0.02);padding:10px;border-radius:12px}
    .board{display:grid;grid-gap:var(--gap);background:transparent;padding:8px}
    .cell{width:var(--cell-size-desktop);height:var(--cell-size-desktop);display:grid;place-items:center;border-radius:6px;
      background:linear-gradient(180deg,rgba(255,255,255,0.03),rgba(255,255,255,0.01));color:var(--text);font-weight:700;user-select:none;cursor:pointer;
      box-shadow: inset 0 -2px 0 rgba(0,0,0,0.25);transition:transform .06s ease, background .12s ease;font-size:14px}
    .cell:active{transform:translateY(1px)}
    .cell.open{background:linear-gradient(180deg,#e6eef6, #d7e8fa);color:#0b1220;font-weight:800}
    .cell.flag{background:linear-gradient(180deg,#ffecf0,#ffe7ee);color:var(--flag)}
    .cell.mine{background:linear-gradient(180deg,#ffe7e7,#ffdede);color:var(--mine)}
    .cell.hit{outline:3px solid rgba(239,68,68,0.15)}
    .n1{color:#2563eb} .n2{color:#16a34a} .n3{color:#ef4444}
    .n4{color:#7c3aed} .n5{color:#b45309} .n6{color:#0f766e}
    .toolbar{display:flex;gap:10px;align-items:center}
    .btn{background:rgba(255,255,255,0.04);border:1px solid rgba(255,255,255,0.03);padding:8px 12px;border-radius:8px;color:var(--text);cursor:pointer}
    .footer{margin-top:12px;font-size:13px;color:rgba(230,238,246,0.8)}
    @media (max-width:820px){:root{--cell-size-desktop:40px}.game-area{flex-direction:column;align-items:center}header{flex-direction:column;align-items:flex-start;gap:8px}}
    @media (max-width:520px){:root{--cell-size-desktop:var(--cell-size-mobile);--gap:3px}.logo{width:42px;height:42px}h1{font-size:16px}}
    .hint{font-size:13px;color:rgba(230,238,246,0.85)}
    .overlay{position:fixed;left:0;top:0;right:0;bottom:0;display:none;align-items:center;justify-content:center}
    .overlay.show{display:flex}
    .dialog{background:linear-gradient(180deg,#0b1220,#122434);padding:20px;border-radius:14px;box-shadow:0 20px 60px rgba(2,6,23,0.7);text-align:center}
    .dialog h2{margin:0 0 10px 0}.small{font-size:13px;color:rgba(230,238,246,0.8)}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo">K</div>
        <div>
          <h1>ÙƒØ§Ø³Ø­Ø© Ø§Ù„Ø£Ù„ØºØ§Ù… - Ø§Ù„Ù…Ø·ÙˆØ±Ø©</h1>
          <div class="hint">Ø´Ø¨ÙƒØ© Ù…ØªÙƒÙŠÙØ© Ù„Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„ ÙˆØ§Ù„ÙƒÙ…Ø¨ÙŠÙˆØªØ± â€” Ø§Ù„Ù…Ø±Ø¨Ø¹Ø§Øª Ù…ØªÙ‚Ø§Ø±Ø¨Ø© ÙˆÙ…Ø¸Ù‡Ø± Ø¹ØµØ±ÙŠ</div>
        </div>
      </div>

      <div class="controls">
        <div class="toolbar">
          <select id="preset" class="btn">
            <option value="easy">Ø³Ù‡Ù„ - 9x9 - 10 Ø£Ù„ØºØ§Ù…</option>
            <option value="normal">Ø¹Ø§Ø¯ÙŠ - 16x16 - 40 Ø£Ù„ØºØ§Ù…</option>
            <option value="hard">ØµØ¹Ø¨ - 24x16 - 99 Ø£Ù„ØºØ§Ù…</option>
            <option value="auto">ØªÙ„Ù‚Ø§Ø¦ÙŠ Ø­Ø³Ø¨ Ø§Ù„Ø¬Ù‡Ø§Ø²</option>
          </select>
          <button id="newBtn" class="btn">Ø¥Ø¹Ø§Ø¯Ø© ØªØ´ØºÙŠÙ„</button>
          <button id="muteBtn" class="btn">ØµÙˆØª: ØªØ´ØºÙŠÙ„</button>
        </div>
      </div>
    </header>

    <main class="panel">
      <div class="meta">
        <div class="info">Ø§Ù„ÙˆÙ‚Øª: <span id="timer">0</span> Ø«</div>
        <div class="info">Ø§Ù„Ø£Ù„ØºØ§Ù… Ø§Ù„Ù…ØªØ¨Ù‚ÙŠØ©: <span id="flagsLeft">0</span></div>
        <div class="info">Ù…Ø­Ø§ÙˆÙ„Ø§Øª: <span id="tries">0</span></div>
      </div>

      <div class="game-area">
        <div class="board-wrap">
          <div id="board" class="board"></div>
        </div>
        <div style="min-width:200px;padding-left:12px;display:flex;flex-direction:column;gap:8px;align-items:flex-start">
          <div class="info" style="padding:10px;border-radius:10px;">ØªØ¹Ù„ÙŠÙ…Ø§Øª: Ø§Ø¶ØºØ· Ù„Ù„ÙƒØ´ÙØŒ Ø§Ø¶ØºØ· Ù…Ø·ÙˆÙ„Ù‹Ø§ Ø£Ùˆ Ø²Ø± ÙŠÙ…ÙŠÙ† Ù„Ù„ÙÙ„Ø§Ø¬Ø².</div>
          <div class="info">Ù†ØµÙŠØ­Ø©: Ù„Ùˆ ØªØ·ÙˆØ± ØªØ·Ø¨ÙŠÙ‚ØŒ Ø§Ø³ØªØ®Ø¯Ù… Ø§Ù„Ù€ `WebView` Ø£Ùˆ Cordova Ù„Ø¹Ù…Ù„ APK Ø³Ø±ÙŠØ¹.</div>
        </div>
      </div>

      <div class="footer">Ù…Ù…ÙƒÙ† ØªØ¹Ø¯ÙŠÙ„ Ø§Ù„Ø£Ù„ÙˆØ§Ù† ÙˆØ­Ø¬Ù… Ø§Ù„Ø®Ù„Ø§ÙŠØ§ ÙÙŠ Ù…Ù„Ù style.css â€” Ø£ÙŠØ¶Ø§Ù‹ Ø£Ø¶ÙØª Ø¯Ø¹Ù… Ù„Ù„Ù…Ø³ (long-press) Ù„Ø¹Ù…Ù„ "Ø¹Ù„Ù…" Ø¹Ù„Ù‰ Ø§Ù„Ù…ÙˆØ¨Ø§ÙŠÙ„.</div>
    </main>
  </div>

  <div id="overlay" class="overlay">
    <div class="dialog">
      <h2 id="resultTitle">Ø§Ù†ØªÙ‡Øª Ø§Ù„Ù„Ø¹Ø¨Ø©</h2>
      <div class="small" id="resultText"></div>
      <div style="margin-top:12px"><button id="restart2" class="btn">Ø­Ø³Ù†Ø§Ù‹ - Ø£Ø¹Ø¯ Ø§Ù„Ù…Ø­Ø§ÙˆÙ„Ø©</button></div>
    </div>
  </div>

  <!-- Ø£ØµÙˆØ§Øª -->
  <audio id="explosionSound" preload="auto" src="https://www.soundjay.com/button/sounds/beep-07.mp3"></audio>
  <audio id="correctSound" preload="auto" src="https://www.soundjay.com/button/sounds/beep-06.mp3"></audio>

  <script>
    // Ø¹Ù†Ø§ØµØ± DOM
    const boardEl = document.getElementById('board');
    const timerEl = document.getElementById('timer');
    const flagsLeftEl = document.getElementById('flagsLeft');
    const presetEl = document.getElementById('preset');
    const newBtn = document.getElementById('newBtn');
    const overlay = document.getElementById('overlay');
    const resultTitle = document.getElementById('resultTitle');
    const resultText = document.getElementById('resultText');
    const restart2 = document.getElementById('restart2');
    const triesEl = document.getElementById('tries');
    const muteBtn = document.getElementById('muteBtn');

    const explosionSound = document.getElementById('explosionSound');
    const correctSound = document.getElementById('correctSound');

    // Ø­Ø§Ù„Ø© ÙˆØµÙ„Ø§Ø­ÙŠØ§Øª
    let gridWidth = 9, gridHeight = 9, minesCount = 10;
    let grid = [];
    let opened = 0, flags = 0, timer=0, timerInterval=null, tries=0;
    let started = false; // Ù…Ù‡Ù…: Ù†Ø³ØªØ®Ø¯Ù…Ù‡ Ù„Ù†Ø¹Ø±Ù Ø£ÙˆÙ„ Ù†Ù‚Ø±Ø©
    let soundEnabled = true;
    let isMobile = ('ontouchstart' in window) || navigator.maxTouchPoints>0;

    function decideAuto(){
      const w = Math.max(window.innerWidth, document.documentElement.clientWidth);
      if (w < 520){ gridWidth = 9; gridHeight = 12; minesCount = 12; }
      else if (w < 900){ gridWidth = 12; gridHeight = 16; minesCount = 30; }
      else { gridWidth = 16; gridHeight = 16; minesCount = 40; }
    }

    function applyPreset(preset){
      if (preset === 'easy'){ gridWidth=9; gridHeight=9; minesCount=10; }
      else if (preset === 'normal'){ gridWidth=16; gridHeight=16; minesCount=40; }
      else if (preset === 'hard'){ gridWidth=24; gridHeight=16; minesCount=99; }
      else if (preset === 'auto'){ decideAuto(); }
    }

    function createEmptyGrid(w,h){
      const arr = [];
      for(let y=0;y<h;y++){
        const row = [];
        for(let x=0;x<w;x++){
          row.push({x,y, mine:false, open:false, flag:false, num:0, el:null});
        }
        arr.push(row);
      }
      return arr;
    }

    function placeMines(firstX, firstY){
      let placed=0;
      while(placed < minesCount){
        const rx = Math.floor(Math.random()*gridWidth);
        const ry = Math.floor(Math.random()*gridHeight);
        const cell = grid[ry][rx];
        if (cell.mine) continue;
        if (Math.abs(rx-firstX)<=1 && Math.abs(ry-firstY)<=1) continue;
        cell.mine = true; placed++;
      }
      for(let y=0;y<gridHeight;y++){
        for(let x=0;x<gridWidth;x++){
          const c = grid[y][x];
          if (c.mine) continue;
          let count=0;
          for(let dy=-1;dy<=1;dy++) for(let dx=-1;dx<=1;dx++){
            const nx=x+dx, ny=y+dy;
            if (nx<0||ny<0||nx>=gridWidth||ny>=gridHeight) continue;
            if (grid[ny][nx].mine) count++;
          }
          c.num = count;
        }
      }
    }

    function resetBoard(){
      // Ø¥Ø¹Ø§Ø¯Ø© Ø§Ù„Ø­Ø§Ù„Ø©
      started = false; opened=0; flags=0; clearInterval(timerInterval); timer=0; timerEl.textContent='0';
      boardEl.innerHTML=''; overlay.classList.remove('show');
      applyPreset(presetEl.value);
      grid = createEmptyGrid(gridWidth, gridHeight);
      boardEl.style.gridTemplateColumns = `repeat(${gridWidth}, 1fr)`;
      flagsLeftEl.textContent = minesCount;
      triesEl.textContent = tries;

      // Ø¥Ù†Ø´Ø§Ø¡ Ø¹Ù†Ø§ØµØ± Ø§Ù„Ø®Ù„Ø§ÙŠØ§
      for(let y=0;y<gridHeight;y++){
        for(let x=0;x<gridWidth;x++){
          const c = grid[y][x];
          const el = document.createElement('div');
          el.className='cell';
          el.dataset.x=x; el.dataset.y=y;
          c.el = el;

          el.addEventListener('click', (e)=>{ onCellClick(e, x, y); });
          el.addEventListener('contextmenu', (e)=>{ e.preventDefault(); toggleFlag(x,y); });

          if (isMobile){
            let pressTimer=null;
            const start = ()=>{ pressTimer = setTimeout(()=>{ toggleFlag(x,y); }, 500); };
            const cancel = ()=>{ if (pressTimer) { clearTimeout(pressTimer); pressTimer=null; } };
            el.addEventListener('touchstart', start);
            el.addEventListener('touchend', cancel);
            el.addEventListener('touchmove', cancel);
            el.addEventListener('touchcancel', cancel);
          }

          boardEl.appendChild(el);
        }
      }
    }

    function onCellClick(e,x,y){
      const cell = grid[y][x];
      if (!started){ placeMines(x,y); startTimer(); started = true; }
      if (cell.open || cell.flag) return;

      if (cell.mine){
        // Ù†Ù„Ø¹Ø¨ ØµÙˆØª Ø§Ù„Ø§Ù†ÙØ¬Ø§Ø±
        if (soundEnabled){ explosionSound.currentTime = 0; explosionSound.play().catch(()=>{}); }
        revealAll(false,x,y);
        return;
      }

      // ØµÙˆØª Ø®ÙÙŠÙ Ù„Ù„Ø®Ù„ÙŠØ© Ø§Ù„ØµØ­ÙŠØ­Ø© (Ù…Ø±Ø© ÙˆØ§Ø­Ø¯Ø© Ø¨Ø§Ù„Ù†Ù‚Ø±Ø©)
      if (soundEnabled){ correctSound.currentTime = 0; correctSound.play().catch(()=>{}); }

      floodOpen(x,y);
      updateState();
      checkWin();
    }

    function floodOpen(sx,sy){
      const stack = [[sx,sy]];
      while(stack.length){
        const [x,y] = stack.pop();
        const c = grid[y][x];
        if (c.open || c.flag) continue;
        c.open = true; opened++;
        c.el.classList.add('open');
        if (c.num>0){ c.el.textContent = c.num; c.el.classList.add('n'+c.num); }
        if (c.num===0){
          for(let dy=-1;dy<=1;dy++) for(let dx=-1;dx<=1;dx++){
            const nx=x+dx, ny=y+dy;
            if (nx<0||ny<0||nx>=gridWidth||ny>=gridHeight) continue;
            if (!grid[ny][nx].open && !grid[ny][nx].mine) stack.push([nx,ny]);
          }
        }
      }
    }

    function toggleFlag(x,y){
      const c = grid[y][x];
      if (c.open) return;
      c.flag = !c.flag;
      if (c.flag){ c.el.classList.add('flag'); flags++; c.el.textContent='âš‘'; }
      else{ c.el.classList.remove('flag'); flags--; c.el.textContent=''; }
      flagsLeftEl.textContent = Math.max(0, minesCount - flags);
    }

    function revealAll(win, hitX, hitY){
      clearInterval(timerInterval);
      // Ù†ÙƒØ´Ù Ø§Ù„Ø£Ù„ØºØ§Ù… ÙˆÙ†Ø¸Ù‡Ø± Ø§Ù„Ù†ØªØ§Ø¦Ø¬
      for(let y=0;y<gridHeight;y++) for(let x=0;x<gridWidth;x++){
        const c = grid[y][x];
        if (c.mine){ c.el.classList.add('mine'); c.el.textContent = 'ğŸ’£'; }
        if (c.flag && !c.mine){ c.el.textContent='âœ–'; }
      }
      // Ù„Ùˆ ÙÙŠ Ù„ØºÙ… ØªÙ… Ø§Ù„Ø¶ØºØ· Ø¹Ù„ÙŠÙ‡
      if (hitX !== undefined && hitX !== null){ grid[hitY][hitX].el.classList.add('hit'); }

      tries++;
      triesEl.textContent = tries;

      if (win){ showResult(true); }
      else{ showResult(false); }
    }

    function checkWin(){
      const total = gridWidth*gridHeight;
      if (opened === total - minesCount){ revealAll(true); }
    }

    function showResult(win){
      if (!win){ resultTitle.textContent='Ø®Ø³Ø±Øª!'; resultText.textContent = 'Ù„Ù‚Ø¯ Ù†ÙØ¬Ø± Ù„ØºÙ…... Ø­Ø§ÙˆÙ„ Ù…Ø±Ø© Ø£Ø®Ø±Ù‰.'; }
      else{ resultTitle.textContent='Ù…Ø¨Ø±ÙˆÙƒ!'; resultText.textContent = `ÙØ²Øª ÙÙŠ ${timer} Ø«Ø§Ù†ÙŠØ© â€” Ù…Ø­Ø§ÙˆÙ„Ø§Øª: ${tries}`; }
      overlay.classList.add('show');
    }

    function startTimer(){ timerInterval = setInterval(()=>{ timer++; timerEl.textContent = timer; }, 1000); }
    function updateState(){ flagsLeftEl.textContent = Math.max(0, minesCount - flags); }

    // Ø£Ø­Ø¯Ø§Ø« Ø§Ù„Ø£Ø²Ø±Ø§Ø±
    newBtn.addEventListener('click', ()=>{ resetBoard(); });
    restart2.addEventListener('click', ()=>{ resetBoard(); overlay.classList.remove('show'); });
    presetEl.addEventListener('change', ()=>{ resetBoard(); });
    window.addEventListener('resize', ()=>{ if (presetEl.value==='auto') resetBoard(); });
    muteBtn.addEventListener('click', ()=>{ soundEnabled = !soundEnabled; muteBtn.textContent = soundEnabled ? 'ØµÙˆØª: ØªØ´ØºÙŠÙ„' : 'ØµÙˆØª: Ø¥ÙŠÙ‚Ø§Ù'; });

    // ØªØ´ØºÙŠÙ„ Ø£ÙˆÙ„ÙŠ
    (function init(){ applyPreset(presetEl.value); resetBoard(); })();

    // Ù…Ù„Ø§Ø­Ø¸Ø§Øª:
    // â€¢ Ø¥Ù† ÙˆØ§Ø¬Ù‡Øª Ù…Ø´ÙƒÙ„Ø© ÙÙŠ Ø§Ù„ØµÙˆØª: Ø§Ù„Ù…ØªØµÙØ­Ø§Øª ØªÙ…Ù†Ø¹ Ø§Ù„ØªØ´ØºÙŠÙ„ Ø§Ù„ØªÙ„Ù‚Ø§Ø¦ÙŠØŒ Ù„ÙƒÙ† Ø§Ù„Ø£ØµÙˆØ§Øª ØªØ¹Ù…Ù„ Ø¨Ø¹Ø¯ ØªÙØ§Ø¹Ù„ Ø§Ù„Ù…Ø³ØªØ®Ø¯Ù… (Ù†Ù‚Ø±Ø©).
    // â€¢ Ù„ØªØºÙŠÙŠØ± Ø§Ù„Ø£ØµÙˆØ§Øª: Ø¹Ø¯Ù„ src ÙÙŠ Ø¹Ù†Ø§ØµØ± <audio> Ø£Ø¹Ù„Ù‰ Ø§Ù„ØµÙØ­Ø©.

  </script>
</body>
</html>
